version: 0.1
component: build
timeoutInSeconds: 6000
runAs: root
shell: bash
env: 
  variables:
    key: "value"
 
  vaultVariables:
  #  EXAMPLE_SECRET: "YOUR-SECRET-OCID"
   
  exportedVariables:
    - BUILDRUN_HASH

steps:  
  - type: Command
    timeoutInSeconds: 1200
    name: "Phyton install"
    command: |
      cd ${OCI_WORKSPACE_DIR}/node_python
      install -y python3
      install -y --enablerepo ol7_optional_latest python3-devel
      install rh-python36-python-pip.noarch
      scl enable rh-python36 bash
      pip install --upgrade pip
      pip install --upgrade jinja2
    onFailure:
      - type: Command
        command: |
          echo "Handling Failure"
          echo "Failure successfully handled"
        timeoutInSeconds: 40
        runAs: root

  - type: Command
    timeoutInSeconds: 1200
    name: "Build container image"
    command: |
      cd ${OCI_WORKSPACE_DIR}/node_python
      docker build --pull --rm -t node-location . 

outputArtifacts:
  - name: output01
    type: DOCKER_IMAGE 
    location: node-location:01